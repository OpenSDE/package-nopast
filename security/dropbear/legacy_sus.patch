# --- SDE-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
#
# Filename: package/.../dropbear/legacy_sus.patch
# Copyright (C) 2010 - 2011 The OpenSDE Project
#
# More information can be found in the files COPYING and README.
#
# This patch file is dual-licensed. It is available under the license the
# patched project is licensed under, as long as it is an OpenSource license
# as defined at http://www.opensource.org/ (e.g. BSD, X11) or under the terms
# of the GNU General Public License as published by the Free Software
# Foundation; either version 2 of the License, or (at your option) any later
# version.
# --- SDE-COPYRIGHT-NOTE-END ---

usleep() was deprecated by SUSv3 and newer LIBCs are starting to enforce that
deprecation.

--- ./svr-auth.c.orig	2011-04-29 16:58:36.000000000 +0200
+++ ./svr-auth.c	2011-04-29 17:01:48.000000000 +0200
@@ -338,11 +338,12 @@
 	encrypt_packet();
 
 	if (incrfail) {
+		struct timespec ts = {0, 250000000L};
 		unsigned int delay;
 		genrandom((unsigned char*)&delay, sizeof(delay));
 		/* We delay for 300ms +- 50ms, 0.1ms granularity */
-		delay = 250000 + (delay % 1000)*100;
-		usleep(delay);
+		ts.tv_nsec += (delay % 1000)*100000L;
+		nanosleep(&ts, NULL);
 		ses.authstate.failcount++;
 	}
 
