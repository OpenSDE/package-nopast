# --- SDE-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
#
# Filename: package/.../scanlogd/scanlogd.conf
# Copyright (C) 2007 - 2008 The OpenSDE Project
# Copyright (C) 2004 - 2006 The T2 SDE Project
# Copyright (C) 1998 - 2004 Clifford Wolf
#
# More information can be found in the files COPYING and README.
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License. A copy of the
# GNU General Public License can be found in the file COPYING.
# --- SDE-COPYRIGHT-NOTE-END ---

makeinstopt=

echo_warning "To monitor the traffic of an entire network, and for"
echo_warning "being able to handle fragmented IP packets use libnids"
echo_warning "for packet capturing!"

if pkginstalled libpcap ; then
	pkgprefix -t libpcap
	var_append makeopt ' ' "PCAP_H=-I$root$( pkgprefix includedir libpcap )"

	if pkginstalled libnids ; then
		pkgprefix -t libnids
		var_append makeopt ' ' "NIDS_H=-I$root$( pkgprefix includedir libnids )"
		var_append makeopt ' ' 'NIDS_L="-L$root$( pkgprefix libdir libnids ) -lnids -lnet -lpcap"'

		var_append makeopt ' ' "libnids"
		echo_status "scanlogd packet capture interface: libnids"
	else
		var_append makeopt ' ' "libpcap"
		echo_status "scanlogd packet capture interface: libpcap"
		echo_warning "The use of libpcap alone is discouraged!"
	fi
else
	# OpenSDE currently just supports linux kernels
	var_append makeopt ' ' "linux"
	echo_status "scanlogd packet capture interface: linux raw socket"
fi

pkg_scanlogd_install() {
	cp -vf scanlogd $root$sbindir
	cp -vf scanlogd.8 $root$mandir
}
hook_add postmake 5 "pkg_scanlogd_install"
