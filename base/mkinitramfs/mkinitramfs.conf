# --- SDE-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
#
# Filename: package/.../mkinitramfs/mkinitramfs.conf
# Copyright (C) 2007 - 2008 The OpenSDE Project
#
# More information can be found in the files COPYING and README.
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License. A copy of the
# GNU General Public License can be found in the file COPYING.
# --- SDE-COPYRIGHT-NOTE-END ---

srctar=none
libdir=$libdir/mkinitrd

makeopt=
makeinstopt=

hook_add postmake 5 'mkinitrd_install'
hook_add postmake 7 'mkinitrd_install_img'

mkinitrd_install() {
	install -v -m 755 "$confdir/mkinitramfs.sh" "$root$sbindir/mkinitramfs"
	for x in $( ls -1d "$confdir/files"/* 2> /dev/null ); do
		cp -vf "$x" "$root$libdir/"
	done
}

mkinitrd_install_img() {
	local image=initrd.img
	if [ -r "$base/config/$config/$image" ]; then
		echo_status "Injecting $image file from config/$config"
		cp -vf "$base/config/$config"/$image "$root/boot/"
	else
		echo_warning "No $image file found in config/$config"
	fi
}
