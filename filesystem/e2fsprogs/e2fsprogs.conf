# --- SDE-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
#
# Filename: package/.../e2fsprogs/e2fsprogs.conf
# Copyright (C) 2008 - 2012 The OpenSDE Project
# Copyright (C) 2004 - 2006 The T2 SDE Project
# Copyright (C) 1998 - 2004 Clifford Wolf
#
# More information can be found in the files COPYING and README.
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License. A copy of the
# GNU General Public License can be found in the file COPYING.
# --- SDE-COPYRIGHT-NOTE-END ---

prefix=
createarchcache=1 # utterly broken configure, assumes hardcoding on cross build
set_confopt

fix_pkgconfig_dir() {
	[ "$prefix" = "" ] || return
	for x in lib/et lib/ss lib/e2p lib/ext2fs lib/uuid lib/blkid ; do
		sed -i 's,\($(libdir)/pkgconfig\),/usr\1,' $x/Makefile.in
	done
}

if [ "$SDECFG_DIETLIBC_e2fsprogs" == "1" ] ; then
	confopt="$confopt --with-diet-libc"
	[ "$dietlibc_dynamic_static" = "dynamic" ] &&
	  var_append confopt " " "--enable-dynamic-e2fsck"
fi

if pkginstalled util-linux; then
	# do not build stuff now provided by util-linux
	for x in libuuid uuidd libblkid fsck; do
		var_append extraconfopt ' ' "--disable-$x"
	done
fi

if [ "$SDECFG_STATIC" = "0" ]; then
	#if atstage native || [ "$crossnative" == "cross" ] ; then
	if ! atstage toolchain ; then
		var_append confopt " " "--enable-elf-shlibs"
	fi
fi

LD=$CC

# the install does not install the headers ... :-(
var_append makeinstopt ' ' 'install-libs'
hook_add preconf 1 'fix_pkgconfig_dir'
