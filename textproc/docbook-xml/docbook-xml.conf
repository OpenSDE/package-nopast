# --- SDE-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
#
# Filename: package/.../docbook-xml/docbook-xml.conf
# Copyright (C) 2007 The OpenSDE Project
#
# More information can be found in the files COPYING and README.
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License. A copy of the
# GNU General Public License can be found in the file COPYING.
# --- SDE-COPYRIGHT-NOTE-END ---

makeopt=
makeinstopt=
autoextract=0

datadir="/usr/share/xml/docbook"

hook_add postmake 5 'docbook_install'

docbook_install() {
	local catalog=$root/etc/xml/docbook
	local dtdver=$( echo $xsrctar | sed -n -e 's,^docbook-xml-\(.*\)\.zip$,\1,p' )
	local URI= dtddir=

	if [ -n "$dtdver" ]; then
		echo_status "DocBook XML DTD V$dtdver"
		dtddir="$datadir/xml-dtd-$dtdver"
		URI="http://www.oasis-open.org/docbook/xml/$dtdver"

		rm -rf "$root$dtddir"
		mkdir -p "$root$dtddir"

		echo "Installing..."
		unzip -d "$root$dtddir" $( match_source_file -p "$xsrctar" )

		echo "Populating /etc/xml/docbook"
		[ -s "$catalog" ] || xmlcatalog --noout --create "$catalog"

		xmlcatalog --noout \
			--add 'public' "-//OASIS//ELEMENTS DocBook XML Information Pool V$dtdver//EN"	"file://$dtddir/dbpoolx.mod"	\
			--add 'public' "-//OASIS//DTD DocBook XML V$dtdver//EN"				"file://$dtddir/docbookx.dtd"	\
			--add 'public' "-//OASIS//ENTITIES DocBook XML Character Entities V$dtdver//EN" "file://$dtddir/dbcentx.mod"	\
			--add 'public' "-//OASIS//ENTITIES DocBook XML Notations V$dtdver//EN" 		"file://$dtddir/dbnotnx.mod"	\
			--add 'public' "-//OASIS//ENTITIES DocBook XML Additional General Entities V$dtdver//EN"	"file://$dtddir/dbgenent.mod"	\
			--add 'public' "-//OASIS//ELEMENTS DocBook XML Document Hierarchy V$dtdver//EN"	"file://$dtddir/dbhierx.mod"	\
			--add 'public' "-//OASIS//DTD XML Exchange Table Model 19990315//EN"		"file://$dtddir/soextblx.dtd"	\
			--add 'public' "-//OASIS//DTD DocBook XML CALS Table Model V$dtdver//EN"	"file://$dtddir/calstblx.dtd"	\
			--add 'rewriteSystem'	"$URI"	"$dtddir" \
			--add 'rewriteURI'	"$URI" 	"$dtddir" \
			--add 'public' "ISO 8879:1986//ENTITIES Publishing//EN"				"file://$dtddir/ent/iso-pub.ent" \
			--add 'public' "ISO 8879:1986//ENTITIES Greek Letters//EN"			"file://$dtddir/ent/iso-grk1.ent" \
			--add 'public' "ISO 8879:1986//ENTITIES Box and Line Drawing//EN"		"file://$dtddir/ent/iso-box.ent" \
			--add 'public' "ISO 8879:1986//ENTITIES Greek Symbols//EN"			"file://$dtddir/ent/iso-grk3.ent" \
			--add 'public' "ISO 8879:1986//ENTITIES Added Math Symbols: Negated Relations//EN"	"file://$dtddir/ent/iso-amsn.ent" \
			--add 'public' "ISO 8879:1986//ENTITIES Numeric and Special Graphic//EN"	"file://$dtddir/ent/iso-num.ent" \
			--add 'public' "ISO 8879:1986//ENTITIES Alternative Greek Symbols//EN"		"file://$dtddir/ent/iso-grk4.ent" \
			--add 'public' "ISO 8879:1986//ENTITIES Diacritical Marks//EN"			"file://$dtddir/ent/iso-dia.ent" \
			--add 'public' "ISO 8879:1986//ENTITIES Monotoniko Greek//EN"			"file://$dtddir/ent/iso-grk2.ent" \
			--add 'public' "ISO 8879:1986//ENTITIES Added Math Symbols: Arrow Relations//EN"	"file://$dtddir/ent/iso-amsa.ent" \
			--add 'public' "ISO 8879:1986//ENTITIES Added Math Symbols: Ordinary//EN"	"file://$dtddir/ent/iso-amso.ent" \
			--add 'public' "ISO 8879:1986//ENTITIES Russian Cyrillic//EN"			"file://$dtddir/ent/iso-cyr1.ent" \
			--add 'public' "ISO 8879:1986//ENTITIES General Technical//EN"			"file://$dtddir/ent/iso-tech.ent" \
			--add 'public' "ISO 8879:1986//ENTITIES Added Math Symbols: Delimiters//EN"	"file://$dtddir/ent/iso-amsc.ent" \
			--add 'public' "ISO 8879:1986//ENTITIES Added Latin 1//EN"			"file://$dtddir/ent/iso-lat1.ent" \
			--add 'public' "ISO 8879:1986//ENTITIES Added Math Symbols: Binary Operators//EN"	"file://$dtddir/ent/iso-amsb.ent" \
			--add 'public' "ISO 8879:1986//ENTITIES Added Latin 2//EN"			"file://$dtddir/ent/iso-lat2.ent" \
			--add 'public' "ISO 8879:1986//ENTITIES Added Math Symbols: Relations//EN"	"file://$dtddir/ent/iso-amsr.ent" \
			--add 'public' "ISO 8879:1986//ENTITIES Non-Russian Cyrillic//EN"		"file://$dtddir/ent/iso-cyr2.ent" \
			"$catalog"
	else
		echo_error "Failed to detect version for $xsrctar."
		false
	fi
}
