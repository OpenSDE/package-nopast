# --- SDE-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
#
# Filename: package/.../dovecot-antispam/dovecot-antispam.conf
# Copyright (C) 2008 - 2009 The OpenSDE Project
#
# More information can be found in the files COPYING and README.
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License. A copy of the
# GNU General Public License can be found in the file COPYING.
# --- SDE-COPYRIGHT-NOTE-END ---

# dovecot is mandantory
pkgprefix -t dovecot

# just doing minimal config adjustments, because the rest is done via makeopt's
hook_add preconf 5 "sed -e 's,\(DOVECOT\=\).*,\1,' defconfig > .config"

# we need to guide a bit where the dovecot headers are installed
var_append makeopt ' ' "DOVECOT=$root$( pkgprefix includedir dovecot )/dovecot"

# backend (select exactly one)
#  dspam-exec           - direct dspam training by calling dspam executable
#  signature-log        - signature logging using dovecot's dict API
#  mailtrain            - send mail to special addresses for training
#  crm114-exec          - direct crm114 training by calling mailreaver.crm

if pkginstalled crm114 crm114-gerh; then
	var_append makeopt ' ' "BACKEND=crm114-exec"
fi

# setting the right install directory
var_append makeopt ' ' "INSTALLDIR=$root$( pkgprefix libdir dovecot )/dovecot/imap"

makeinstopt="$makeopt install"

hook_add postmake 7 'cp -v antispam.7 $root$mandir/man7/'
