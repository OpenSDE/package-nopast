# --- SDE-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
#
# Filename: package/.../qsheff/qsheff.conf
# Copyright (C) 2006 The OpenSDE Project
#
# More information can be found in the files COPYING and README.
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License. A copy of the
# GNU General Public License can be found in the file COPYING.
# --- SDE-COPYRIGHT-NOTE-END ---

prefix=opt/$pkg
set_confopt

sysconfdir=${sysconfdir%/$pkg}
datadir=/var/qsheff

pkgprefix -t qmail
var_append confopt ' ' "--with-qmaildir=/$(pkgprefix qmail)"

var_append confopt ' ' '--with-custom-prog'
var_append confopt ' ' '--enable-subject-tag'

# direct ClamAV support
if pkginstalled clamav; then
	var_append confopt ' ' '--with-clamav'
	var_append confopt ' ' '--with-clamd-socket=/var/run/clamd'
fi

# patched for QMAILQUEUE ?
if [ "$SDECFG_PKG_QMAIL_LDAP" = '1' -o "$SDECFG_PKG_QMAIL_QUEUE" = '1' ]; then
	var_append confopt ' ' '--enable-qq-patch'
fi

hook_add postmake 5 'qsheff_create_var'
qsheff_create_var() {
	mkdir -p $root$datadir/{spool,tmp}
	mkdir -p $root$datadir/{backup,quarantine}/{0,1,2,3,4,5,6,7,8,9,A,B,C,D,E,F,x}
}

hook_add postmake 5 'qsheff_permissions'
qsheff_permissions() {
	chown -v root:21 $root$bindir/qsheff
	chmod -v 4511 $root$bindir/qsheff
}
